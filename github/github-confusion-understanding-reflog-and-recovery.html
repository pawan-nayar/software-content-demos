<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Understanding Reflog and Recovery</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- Compact Styles (from previous file) --- */
        :root {
            --bg-page: #f8f9fa;
            --bg-surface: #ffffff;
            --bg-muted: #f1f3f5;
            --text-primary: #2c3e50;
            --text-secondary: #6c757d;
            --border-color: #dee2e6;
            --accent: #dd6b20;
            --warning: #f03e3e;
            --recovered: #27ae60;
            --font-main: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --font-code: 'Courier New', Courier, monospace;
        }

        /* --- Base --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font-main); background: var(--bg-page); color: var(--text-primary); line-height: 1.5; }
        
        /* --- Layout --- */
        .container { max-width: 800px; margin: 0 auto; padding: 1.5rem 1rem; }
        h1 { text-align: center; margin-bottom: 1.5rem; font-size: 1.5rem; }
        .panel { background: var(--bg-surface); border-radius: 8px; padding: 1.25rem; margin-bottom: 1.25rem; box-shadow: 0 1px 4px rgba(0,0,0,0.07); }
        .step-header { display: flex; align-items: center; margin-bottom: 1rem; }
        .step-number { background: var(--accent); color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 0.75rem; flex-shrink: 0; font-size: 1rem; }
        .step-title { font-size: 1.25rem; font-weight: 600; }
        p { font-size: 0.95rem; margin-bottom: 1rem; }
        
        /* --- Visual Demo --- */
        .visual-demo { background: var(--bg-muted); border: 1px solid var(--border-color); border-radius: 6px; padding: 1rem; margin: 1rem 0; display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 1rem; }
        .explanation { background: var(--bg-muted); border-left: 3px solid var(--accent); border-radius: 4px; padding: 0.75rem 1rem; margin: 1rem 0; font-size: 0.9rem; }
        .explanation strong { font-weight: 600; }
        .next-button { background: var(--accent); color: white; border: none; padding: 0.6rem 1.2rem; border-radius: 5px; font-size: 0.9rem; font-weight: 600; cursor: pointer; display: block; margin: 1rem auto 0; transition: opacity 0.2s; }
        .next-button:hover { opacity: 0.85; }
        .hidden { display: none; }

        /* --- DAG Visualization Styles --- */
        .dag-container { font-family: var(--font-code); font-size: 0.8rem; display: flex; align-items: center; gap: 0.5rem; width: 100%; justify-content: center; }
        .commit-node { background: var(--bg-surface); border: 1px solid var(--border-color); border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-weight: bold; position: relative; transition: all 0.3s; }
        .dag-container .arrow { font-size: 1.2rem; color: var(--text-secondary); }
        .pointers { display: flex; gap: 0.5rem; margin-left: 0.5rem; flex-direction: column; align-items: flex-start; }
        .pointer { padding: 0.25rem 0.6rem; border-radius: 100px; font-weight: bold; color: white; font-size: 0.75rem; transition: all 0.3s; }
        .pointer-branch { background: var(--recovered); }
        .pointer-head { background: var(--accent); }
        .commit-node.lost { opacity: 0.4; border-style: dashed; }
        .commit-node.highlighted { border-color: var(--accent); transform: scale(1.1); box-shadow: 0 0 10px rgba(221, 107, 32, 0.5); }
        
        /* --- Reflog Styles --- */
        .reflog-panel { display: flex; flex-direction: column; gap: 1rem; }
        @media (min-width: 768px) { .reflog-panel { flex-direction: row; } }
        .reflog-timeline { flex: 1; border-left: 2px solid var(--border-color); padding-left: 1rem; font-family: var(--font-code); }
        .reflog-entry { background: var(--bg-surface); border: 1px solid var(--border-color); border-radius: 4px; padding: 0.5rem 0.75rem; margin-bottom: 0.5rem; cursor: pointer; transition: background-color 0.2s; font-size: 0.85rem; }
        .reflog-entry:hover { background-color: var(--bg-muted); }
        .reflog-entry.active { border-left: 3px solid var(--accent); font-weight: bold; }
        .reflog-entry .ref { color: var(--accent); }
        .reflog-entry .action { color: var(--text-secondary); }

        .recover-button { background-color: var(--recovered); color: white; display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Reflog and Recovery</h1>

        <!-- Step 1: Normal History -->
        <div class="panel" id="step1">
            <div class="step-header">
                <div class="step-number">1</div>
                <div class="step-title">Normal History</div>
            </div>
            <p>You have a simple history with three commits. Both `HEAD` and the `main` branch point to the latest commit, `c3d4`.</p>
            <div class="visual-demo">
                <div class="dag-container">
                    <div class="commit-node" id="dag1-a1b2">a1b2</div>
                    <div class="arrow">&larr;</div>
                    <div class="commit-node" id="dag1-b2c3">b2c3</div>
                    <div class="arrow">&larr;</div>
                    <div class="commit-node" id="dag1-c3d4">c3d4</div>
                    <div class="pointers">
                        <div class="pointer pointer-branch">main</div>
                        <div class="pointer pointer-head">HEAD</div>
                    </div>
                </div>
            </div>
            <div class="explanation">
                <strong>Key Point:</strong> This is your "official" project history. `git log` would show you these three commits.
            </div>
            <button class="next-button" onclick="showStep(2)">Next: The "Accident" &rarr;</button>
        </div>

        <!-- Step 2: The Accident -->
        <div class="panel hidden" id="step2">
            <div class="step-header">
                <div class="step-number">2</div>
                <div class="step-title">The "Accident"</div>
            </div>
            <p>You run `git reset --hard HEAD~1`, mistakenly believing it will only remove the last commit. Your `main` branch pointer moves back to `b2c3`.</p>
            <div class="visual-demo">
                <div class="dag-container">
                    <div class="commit-node" id="dag2-a1b2">a1b2</div>
                    <div class="arrow">&larr;</div>
                    <div class="commit-node" id="dag2-b2c3">b2c3</div>
                    <div class="pointers" id="pointers-step2">
                        <div class="pointer pointer-branch">main</div>
                        <div class="pointer pointer-head">HEAD</div>
                    </div>
                    <div class="arrow" style="opacity: 0.4;">&larr;</div>
                    <div class="commit-node lost" id="dag2-c3d4">c3d4</div>
                </div>
            </div>
            <div class="explanation">
                <strong>Key Point:</strong> Commit `c3d4` is now "lost"! No branch points to it. `git log` won't show it anymore, and eventually, Git will delete it.
            </div>
            <button class="next-button" onclick="showStep(3)">Next: The Reflog to the Rescue &rarr;</button>
        </div>

        <!-- Step 3: The Reflog -->
        <div class="panel hidden" id="step3">
            <div class="step-header">
                <div class="step-number">3</div>
                <div class="step-title">The Reflog to the Rescue</div>
            </div>
            <p>Git's reflog is your safety net. It's a private log of everywhere `HEAD` has been. Click on an entry to see the state of the repository at that time.</p>
            <div class="visual-demo reflog-panel">
                <div class="dag-container" style="flex: 1.5;">
                    <div class="commit-node" id="dag3-a1b2">a1b2</div>
                    <div class="arrow">&larr;</div>
                    <div class="commit-node" id="dag3-b2c3">b2c3</div>
                    <div class="pointers" id="pointers-step3">
                        <div class="pointer pointer-branch">main</div>
                        <div class="pointer pointer-head">HEAD</div>
                    </div>
                    <div class="arrow" style="opacity: 0.4;">&larr;</div>
                    <div class="commit-node lost" id="dag3-c3d4">c3d4</div>
                </div>
                <div class="reflog-timeline">
                    <div class="reflog-entry" onclick="selectReflog(this, 'c3d4')">
                        <span class="ref">HEAD@{1}:</span> <span class="action">commit: Add feature X</span>
                    </div>
                     <div class="reflog-entry" onclick="selectReflog(this, 'b2c3')">
                        <span class="ref">HEAD@{2}:</span> <span class="action">commit: Refactor styles</span>
                    </div>
                    <div class="reflog-entry" onclick="selectReflog(this, 'a1b2')">
                        <span class="ref">HEAD@{3}:</span> <span class="action">commit: Initial commit</span>
                    </div>
                </div>
            </div>
            <div class="explanation">
                <strong>Key Point:</strong> The reflog shows the commit `c3d4` was at `HEAD@{1}` (one move ago). Even though no branch points to it, Git remembers it was there.
            </div>
            <button class="next-button" onclick="showStep(4)">Next: The Recovery &rarr;</button>
        </div>

        <!-- Step 4: The Recovery -->
        <div class="panel hidden" id="step4">
             <div class="step-header">
                <div class="step-number">4</div>
                <div class="step-title">The Recovery</div>
            </div>
            <p>With the "lost" commit selected via the reflog, you can create a new branch to point to it, making it safe and accessible again.</p>
             <div class="visual-demo reflog-panel">
                 <div class="dag-container" style="flex: 1.5;">
                    <div class="commit-node" id="dag4-a1b2">a1b2</div>
                    <div class="arrow">&larr;</div>
                    <div class="commit-node" id="dag4-b2c3">b2c3</div>
                    <div class="pointers" id="pointers-step4-main">
                        <div class="pointer pointer-branch">main</div>
                        <div class="pointer pointer-head">HEAD</div>
                    </div>
                    <div class="arrow" style="opacity: 0.4;">&larr;</div>
                    <div class="commit-node lost" id="dag4-c3d4">c3d4
                        <div class="pointers" id="pointers-step4-recovered" style="opacity: 0; position: absolute; left: 120%; top: 0;">
                            <div class="pointer pointer-branch" style="background-color: var(--warning);">recovered</div>
                        </div>
                    </div>
                </div>
                <div class="reflog-timeline">
                    <div class="reflog-entry active" onclick="selectReflog(this, 'c3d4')">
                        <span class="ref">HEAD@{1}:</span> <span class="action">commit: Add feature X</span>
                    </div>
                    <button class="next-button recover-button" onclick="recoverCommit()">Recover this Commit</button>
                </div>
            </div>
             <div class="explanation">
                <strong>Key Point:</strong> Clicking "Recover" simulates running `git branch recovered HEAD@{1}`. This creates a new branch named `recovered` pointing to `c3d4`. The commit is no longer lost.
            </div>
            <button class="next-button" onclick="showStep(1)">Start Over</button>
        </div>
    </div>

    <script>
        function showStep(stepNumber) {
            document.querySelectorAll('.panel').forEach(panel => panel.classList.add('hidden'));
            const stepToShow = document.getElementById('step' + stepNumber);
            if (stepToShow) {
                stepToShow.classList.remove('hidden');
                // Reset states for interactive demos
                if (stepNumber === 3) selectReflog(document.querySelector('.reflog-entry'), 'c3d4');
                if (stepNumber === 4) selectReflog(document.querySelector('#step4 .reflog-entry'), 'c3d4');

                // Reset recovery visibility
                const recoveredPointer = document.getElementById('pointers-step4-recovered');
                if (recoveredPointer) recoveredPointer.style.opacity = '0';
            }
        }

        function selectReflog(el, commitId) {
            // Manage active class on reflog entries within the same panel
            el.parentElement.querySelectorAll('.reflog-entry').forEach(entry => entry.classList.remove('active'));
            el.classList.add('active');

            // Find the correct DAG to manipulate
            const panel = el.closest('.panel');
            const dagNodes = panel.querySelectorAll('.commit-node');
            
            dagNodes.forEach(node => node.classList.remove('highlighted'));
            const nodeToHighlight = panel.querySelector(`#dag${panel.id.slice(-1)}-${commitId}`);
            if (nodeToHighlight) {
                nodeToHighlight.classList.add('highlighted');
            }
            
            // Show recover button if in final step and correct commit is selected
            const recoverButton = panel.querySelector('.recover-button');
            if (recoverButton) {
                recoverButton.style.display = (commitId === 'c3d4') ? 'block' : 'none';
            }
        }

        function recoverCommit() {
            const recoveredPointer = document.getElementById('pointers-step4-recovered');
            const lostCommit = document.getElementById('dag4-c3d4');
            if (recoveredPointer && lostCommit) {
                recoveredPointer.style.opacity = '1';
                lostCommit.classList.remove('lost');
                lostCommit.style.borderColor = 'var(--recovered)';
            }
        }
    </script>
</body>
</html>
