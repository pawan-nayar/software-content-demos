<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt Evolution - The Magic of Words</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .app-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 15px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 20px;
            color: white;
        }

        .title {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 6px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
            font-weight: 400;
        }

        /* Theme Selection Screen */
        .theme-selection {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 18px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center;
        }

        .theme-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .theme-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 14px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .theme-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
            border-color: #667eea;
        }

        .theme-emoji {
            font-size: 2.2rem;
            margin-bottom: 10px;
            display: block;
        }

        .theme-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 6px;
        }

        .theme-seed {
            color: #667eea;
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 6px;
        }

        .theme-description {
            color: #666;
            font-size: 0.85rem;
            line-height: 1.4;
        }

        /* Main Content Card */
        .main-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 18px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            flex: 1;
            position: relative;
            overflow: hidden;
            display: none;
        }

        /* Phase Indicator */
        .phase-indicator {
            background: linear-gradient(45deg, #ff6b6b, #ffa726);
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        /* Progress Bar */
        .progress-container {
            background: #f0f0f0;
            height: 3px;
            border-radius: 2px;
            margin-bottom: 8px;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(45deg, #667eea, #764ba2);
            height: 100%;
            border-radius: 3px;
            transition: width 0.8s ease;
            width: 16.67%;
        }

        /* Step Info */
        .step-info {
            margin-bottom: 8px;
        }

        .step-number {
            color: #667eea;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .lesson-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin: 2px 0 3px 0;
            color: #2c3e50;
        }

        .lesson-explanation {
            color: #666;
            font-size: 0.85rem;
            line-height: 1.3;
            margin-bottom: 6px;
        }

        /* Main Prompt Display */
        .prompt-display {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 8px;
            margin: 6px 0;
            text-align: center;
            position: relative;
            min-height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .current-prompt {
            font-size: 1rem;
            line-height: 1.3;
            color: #2c3e50;
            font-weight: 500;
        }

        /* Word Categories */
        .word-time { color: #ff6b35; font-weight: 600; padding: 2px 4px; border-radius: 4px; }
        .word-place { color: #2196F3; font-weight: 600; padding: 2px 4px; border-radius: 4px; }
        .word-mood { color: #9c27b0; font-weight: 600; padding: 2px 4px; border-radius: 4px; }
        .word-artifact { color: #795548; font-weight: 600; padding: 2px 4px; border-radius: 4px; }
        .word-texture { color: #607d8b; font-weight: 600; padding: 2px 4px; border-radius: 4px; }
        .word-light { color: #ffc107; font-weight: 600; padding: 2px 4px; border-radius: 4px; }
        .word-flora { color: #4caf50; font-weight: 600; padding: 2px 4px; border-radius: 4px; }
        .word-weather { color: #00bcd4; font-weight: 600; padding: 2px 4px; border-radius: 4px; }
        .word-creature { color: #e91e63; font-weight: 600; padding: 2px 4px; border-radius: 4px; }

        /* Clickable words in exploration phase */
        .word-clickable {
            cursor: pointer;
            background: rgba(255, 255, 255, 0.8);
            border: 2px dashed #ccc;
            border-radius: 6px;
            padding: 4px 8px;
            margin: 0 2px;
            transition: all 0.3s ease;
            position: relative;
        }

        .word-clickable:hover {
            background: white;
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .category-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 10;
        }

        .word-clickable:hover .category-tooltip {
            opacity: 1;
        }

        /* Enhanced Substitution Panel */
        .substitution-panel {
            background: #fff;
            border: 1px solid #667eea;
            border-radius: 6px;
            padding: 8px;
            margin-top: 5px;
            display: none;
            max-height: 180px;
            overflow-y: auto;
            position: sticky;
            bottom: 0;
            z-index: 100;
        }

        .substitution-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .substitution-title {
            font-weight: 600;
            color: #667eea;
            font-size: 0.8rem;
        }

        .close-panel {
            background: #f8f9fa;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 1.2rem;
            color: #666;
        }

        .substitution-sections {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .substitution-section {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 3px;
            padding: 4px;
        }

        .section-title {
            font-weight: 600;
            color: #495057;
            margin-bottom: 2px;
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .substitution-options {
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
        }

        .substitution-option {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 3px;
            padding: 3px 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.7rem;
        }

        .substitution-option:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .random-suggestion {
            background: linear-gradient(45deg, #ff6b6b, #ffa726);
            color: white;
            border: none;
            padding: 3px 6px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 4px;
            transition: all 0.3s ease;
            font-size: 0.65rem;
        }

        .random-suggestion:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.4);
        }

        /* Controls */
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
            gap: 10px;
        }

        .btn {
            padding: 6px 15px;
            border: none;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            font-size: 0.75rem;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #666;
            border: 2px solid #e9ecef;
        }

        .btn-secondary:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Phase transition */
        .phase-transition {
            background: linear-gradient(45deg, #4caf50, #8bc34a);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin: 20px 0;
            font-weight: 600;
            animation: fadeInScale 0.8s ease;
            display: none;
        }

        .exploration-actions {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 8px;
            margin-top: 6px;
            text-align: center;
            display: none;
        }

        .action-buttons {
            display: flex;
            gap: 6px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 6px;
        }

        .action-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 4px 10px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.75rem;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        /* Animations */
        @keyframes fadeInScale {
            0% { opacity: 0; transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }

        .prompt-word-enter {
            animation: wordEnter 0.6s ease;
        }

        @keyframes wordEnter {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .app-container { padding: 8px; }
            .main-card, .theme-selection { padding: 15px; }
            .title { font-size: 1.6rem; }
            .current-prompt { font-size: 1.1rem; }
            .controls { flex-direction: column; gap: 10px; }
            .btn { width: 100%; }
            .theme-grid { grid-template-columns: 1fr; }
            .action-buttons { flex-direction: column; }
        }

        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <h1 class="title">✨ Prompt Evolution</h1>
            <p class="subtitle">Discover the magic of word choice in creative prompts</p>
        </div>

        <!-- Theme Selection Screen -->
        <div class="theme-selection" id="themeSelection">
            <h2 style="font-size: 1.6rem; margin-bottom: 12px; color: #2c3e50;">Choose Your Creative Journey</h2>
            <p style="color: #666; margin-bottom: 20px; font-size: 0.95rem;">Each theme offers a unique path to explore how words build worlds</p>
            
            <div class="theme-grid" id="themeGrid">
                <!-- Themes will be populated by JavaScript -->
            </div>
        </div>

        <!-- Main Game Content -->
        <div class="main-card" id="mainCard">
            <!-- Phase Indicator -->
            <div class="phase-indicator" id="phaseIndicator">
                🎓 Discovery Journey
            </div>

            <!-- Progress Bar -->
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>

            <!-- Step Information -->
            <div class="step-info">
                <div class="step-number" id="stepNumber">Step 1 of 6</div>
                <h2 class="lesson-title" id="lessonTitle">Start Small</h2>
                <p class="lesson-explanation" id="lessonExplanation">
                    Begin with a minimal seed - a simple, core idea that can be gradually expanded upon.
                </p>
            </div>

            <!-- Main Prompt Display -->
            <div class="prompt-display">
                <div class="current-prompt" id="currentPrompt">
                    <!-- Prompt will be populated by JavaScript -->
                </div>
            </div>

            <!-- Phase Transition Message -->
            <div class="phase-transition" id="phaseTransition">
                🎉 Journey Complete! Now let's explore what happens when we make different choices...
            </div>

            <!-- Exploration Actions - Hidden by default, shown after START EXPLORING -->
            <div class="exploration-actions" id="explorationActions" style="display: none;">
                <h3 style="color: #2c3e50; margin-bottom: 8px; font-size: 1.1rem;">Ready to Explore?</h3>
                <p style="color: #666; margin-bottom: 10px; font-size: 0.9rem;">Click any colored word above to see alternatives, or try these actions:</p>
                <div class="action-buttons">
                    <button class="action-btn" onclick="suggestRandomChange()">🎲 Surprise Me!</button>
                    <button class="action-btn" onclick="showAllCategories()">📚 View All Categories</button>
                    <button class="action-btn" onclick="resetToStart()">🔄 Try Different Theme</button>
                </div>
            </div>

            <!-- Enhanced Substitution Panel -->
            <div class="substitution-panel" id="substitutionPanel">
                <div class="substitution-header">
                    <div class="substitution-title" id="substitutionTitle">Choose a different word:</div>
                    <button class="close-panel" onclick="closeSubstitutionPanel()">×</button>
                </div>
                
                <div class="substitution-sections" id="substitutionSections">
                    <!-- Sections will be populated by JavaScript -->
                </div>
                
                <button class="random-suggestion" onclick="randomSubstitution()">
                    🎲 Surprise me with this category!
                </button>
            </div>

            <!-- Controls -->
            <div class="controls">
                <button class="btn btn-secondary" id="prevBtn" disabled>← Previous</button>
                <div style="text-align: center; color: #666; font-size: 0.9rem;">
                    <div id="hintText">Watch how each step builds upon the last</div>
                </div>
                <button class="btn btn-primary" id="nextBtn">Next Step →</button>
            </div>
        </div>
    </div>

    <script>
        // Enhanced theme data with 10 different starting journeys
        const themes = [
            {
                name: "Mystical Garden",
                emoji: "🌙",
                seed: "Twilight Garden",
                description: "Explore enchanted nature and mysterious atmospheres",
                journey: [
                    { lesson: "Start small", reason: "Begin with a minimal seed", prompt: "Twilight Garden", words: [
                        {word: "Twilight", category: "Time of Day", values: ["Dusk", "Dawn", "Sunrise", "Golden Hour", "Sunset", "Midnight", "Evening", "Starlit Hour", "Blue Hour", "Moonrise"]},
                        {word: "Garden", category: "Place of Nature", values: ["Grove", "Orchard", "Meadow", "Courtyard", "Sanctuary", "Vineyard", "Glade", "Clearing", "Dell", "Arbor"]}
                    ]},
                    { lesson: "Add emotion", reason: "Infuse feeling into the scene", prompt: "Serene Twilight Garden", words: [
                        {word: "Serene", category: "Mood", values: ["Tranquil", "Mysterious", "Enchanting", "Peaceful", "Dreamy", "Mystical", "Sacred", "Haunting", "Ethereal", "Magical"]},
                        {word: "Twilight", category: "Time of Day", values: ["Dusk", "Dawn", "Sunrise", "Golden Hour", "Sunset", "Midnight", "Evening", "Starlit Hour", "Blue Hour", "Moonrise"]},
                        {word: "Garden", category: "Place of Nature", values: ["Grove", "Orchard", "Meadow", "Courtyard", "Sanctuary", "Vineyard", "Glade", "Clearing", "Dell", "Arbor"]}
                    ]},
                    { lesson: "Specify subject", reason: "Introduce a focal element", prompt: "Serene Twilight Garden with a marble Statue", words: [
                        {word: "Serene", category: "Mood", values: ["Tranquil", "Mysterious", "Enchanting", "Peaceful", "Dreamy", "Mystical", "Sacred", "Haunting", "Ethereal", "Magical"]},
                        {word: "Twilight", category: "Time of Day", values: ["Dusk", "Dawn", "Sunrise", "Golden Hour", "Sunset", "Midnight", "Evening", "Starlit Hour", "Blue Hour", "Moonrise"]},
                        {word: "Garden", category: "Place of Nature", values: ["Grove", "Orchard", "Meadow", "Courtyard", "Sanctuary", "Vineyard", "Glade", "Clearing", "Dell", "Arbor"]},
                        {word: "Statue", category: "Artifact", values: ["Fountain", "Sundial", "Altar", "Throne", "Obelisk", "Shrine", "Monument", "Pillar", "Archway", "Gazebo"]}
                    ]},
                    { lesson: "Add detail", reason: "Enhance specificity", prompt: "Serene Twilight Garden with a weathered, marble Statue", words: [
                        {word: "Serene", category: "Mood", values: ["Tranquil", "Mysterious", "Enchanting", "Peaceful", "Dreamy", "Mystical", "Sacred", "Haunting", "Ethereal", "Magical"]},
                        {word: "Twilight", category: "Time of Day", values: ["Dusk", "Dawn", "Sunrise", "Golden Hour", "Sunset", "Midnight", "Evening", "Starlit Hour", "Blue Hour", "Moonrise"]},
                        {word: "Garden", category: "Place of Nature", values: ["Grove", "Orchard", "Meadow", "Courtyard", "Sanctuary", "Vineyard", "Glade", "Clearing", "Dell", "Arbor"]},
                        {word: "weathered", category: "Texture/Condition", values: ["gleaming", "moss-covered", "ancient", "cracked", "polished", "worn", "ornate", "simple", "elaborate", "timeworn"]},
                        {word: "Statue", category: "Artifact", values: ["Fountain", "Sundial", "Altar", "Throne", "Obelisk", "Shrine", "Monument", "Pillar", "Archway", "Gazebo"]}
                    ]},
                    { lesson: "Add lighting", reason: "Control atmosphere with light", prompt: "Serene Twilight Garden with a weathered, marble Statue, bathed in soft moonlight", words: [
                        {word: "Serene", category: "Mood", values: ["Tranquil", "Mysterious", "Enchanting", "Peaceful", "Dreamy", "Mystical", "Sacred", "Haunting", "Ethereal", "Magical"]},
                        {word: "Twilight", category: "Time of Day", values: ["Dusk", "Dawn", "Sunrise", "Golden Hour", "Sunset", "Midnight", "Evening", "Starlit Hour", "Blue Hour", "Moonrise"]},
                        {word: "Garden", category: "Place of Nature", values: ["Grove", "Orchard", "Meadow", "Courtyard", "Sanctuary", "Vineyard", "Glade", "Clearing", "Dell", "Arbor"]},
                        {word: "weathered", category: "Texture/Condition", values: ["gleaming", "moss-covered", "ancient", "cracked", "polished", "worn", "ornate", "simple", "elaborate", "timeworn"]},
                        {word: "Statue", category: "Artifact", values: ["Fountain", "Sundial", "Altar", "Throne", "Obelisk", "Shrine", "Monument", "Pillar", "Archway", "Gazebo"]},
                        {word: "moonlight", category: "Light Source", values: ["starlight", "candlelight", "firelight", "sunbeams", "lantern glow", "torch flame", "fairy lights", "crystal glow", "aurora", "bioluminescence"]}
                    ]},
                    { lesson: "Add flora", reason: "Introduce plant life for richness", prompt: "Serene Twilight Garden with a weathered, marble Statue, bathed in soft moonlight, among ancient cherry trees", words: [
                        {word: "Serene", category: "Mood", values: ["Tranquil", "Mysterious", "Enchanting", "Peaceful", "Dreamy", "Mystical", "Sacred", "Haunting", "Ethereal", "Magical"]},
                        {word: "Twilight", category: "Time of Day", values: ["Dusk", "Dawn", "Sunrise", "Golden Hour", "Sunset", "Midnight", "Evening", "Starlit Hour", "Blue Hour", "Moonrise"]},
                        {word: "Garden", category: "Place of Nature", values: ["Grove", "Orchard", "Meadow", "Courtyard", "Sanctuary", "Vineyard", "Glade", "Clearing", "Dell", "Arbor"]},
                        {word: "weathered", category: "Texture/Condition", values: ["gleaming", "moss-covered", "ancient", "cracked", "polished", "worn", "ornate", "simple", "elaborate", "timeworn"]},
                        {word: "Statue", category: "Artifact", values: ["Fountain", "Sundial", "Altar", "Throne", "Obelisk", "Shrine", "Monument", "Pillar", "Archway", "Gazebo"]},
                        {word: "moonlight", category: "Light Source", values: ["starlight", "candlelight", "firelight", "sunbeams", "lantern glow", "torch flame", "fairy lights", "crystal glow", "aurora", "bioluminescence"]},
                        {word: "cherry trees", category: "Flora", values: ["weeping willows", "ancient oaks", "bamboo groves", "rose bushes", "lavender fields", "ivy vines", "jasmine", "wisteria", "magnolia", "cedar trees"]}
                    ]}
                ]
            },
            {
                name: "Urban Adventure",
                emoji: "🌃",
                seed: "Neon Alley",
                description: "Dive into cyberpunk cities and urban mysteries",
                journey: [
                    { lesson: "Start small", reason: "Begin with a minimal seed", prompt: "Neon Alley", words: [
                        {word: "Neon", category: "Light Source", values: ["LED", "Holographic", "Flickering", "Bright", "Glowing", "Electric", "Pulsing", "Vibrant", "Colorful", "Blazing"]},
                        {word: "Alley", category: "Place of Nature", values: ["Street", "Boulevard", "Corridor", "Pathway", "Passage", "Avenue", "Lane", "Tunnel", "Underpass", "Walkway"]}
                    ]},
                    { lesson: "Add emotion", reason: "Infuse feeling into the scene", prompt: "Gritty Neon Alley", words: [
                        {word: "Gritty", category: "Mood", values: ["Sleek", "Dark", "Vibrant", "Mysterious", "Bustling", "Abandoned", "Futuristic", "Dangerous", "Electric", "Atmospheric"]},
                        {word: "Neon", category: "Light Source", values: ["LED", "Holographic", "Flickering", "Bright", "Glowing", "Electric", "Pulsing", "Vibrant", "Colorful", "Blazing"]},
                        {word: "Alley", category: "Place of Nature", values: ["Street", "Boulevard", "Corridor", "Pathway", "Passage", "Avenue", "Lane", "Tunnel", "Underpass", "Walkway"]}
                    ]},
                    { lesson: "Specify subject", reason: "Introduce a focal element", prompt: "Gritty Neon Alley with a chrome Motorcycle", words: [
                        {word: "Gritty", category: "Mood", values: ["Sleek", "Dark", "Vibrant", "Mysterious", "Bustling", "Abandoned", "Futuristic", "Dangerous", "Electric", "Atmospheric"]},
                        {word: "Neon", category: "Light Source", values: ["LED", "Holographic", "Flickering", "Bright", "Glowing", "Electric", "Pulsing", "Vibrant", "Colorful", "Blazing"]},
                        {word: "Alley", category: "Place of Nature", values: ["Street", "Boulevard", "Corridor", "Pathway", "Passage", "Avenue", "Lane", "Tunnel", "Underpass", "Walkway"]},
                        {word: "Motorcycle", category: "Artifact", values: ["Car", "Drone", "Robot", "Terminal", "Screen", "Booth", "Vendor", "Kiosk", "Vehicle", "Mech"]}
                    ]},
                    { lesson: "Add detail", reason: "Enhance specificity", prompt: "Gritty Neon Alley with a rain-soaked, chrome Motorcycle", words: [
                        {word: "Gritty", category: "Mood", values: ["Sleek", "Dark", "Vibrant", "Mysterious", "Bustling", "Abandoned", "Futuristic", "Dangerous", "Electric", "Atmospheric"]},
                        {word: "Neon", category: "Light Source", values: ["LED", "Holographic", "Flickering", "Bright", "Glowing", "Electric", "Pulsing", "Vibrant", "Colorful", "Blazing"]},
                        {word: "Alley", category: "Place of Nature", values: ["Street", "Boulevard", "Corridor", "Pathway", "Passage", "Avenue", "Lane", "Tunnel", "Underpass", "Walkway"]},
                        {word: "rain-soaked", category: "Texture/Condition", values: ["gleaming", "rusted", "polished", "damaged", "pristine", "worn", "upgraded", "modified", "steaming", "sparking"]},
                        {word: "Motorcycle", category: "Artifact", values: ["Car", "Drone", "Robot", "Terminal", "Screen", "Booth", "Vendor", "Kiosk", "Vehicle", "Mech"]}
                    ]},
                    { lesson: "Add weather", reason: "Use weather to transform the tone", prompt: "Gritty Neon Alley with a rain-soaked, chrome Motorcycle, under heavy rainfall", words: [
                        {word: "Gritty", category: "Mood", values: ["Sleek", "Dark", "Vibrant", "Mysterious", "Bustling", "Abandoned", "Futuristic", "Dangerous", "Electric", "Atmospheric"]},
                        {word: "Neon", category: "Light Source", values: ["LED", "Holographic", "Flickering", "Bright", "Glowing", "Electric", "Pulsing", "Vibrant", "Colorful", "Blazing"]},
                        {word: "Alley", category: "Place of Nature", values: ["Street", "Boulevard", "Corridor", "Pathway", "Passage", "Avenue", "Lane", "Tunnel", "Underpass", "Walkway"]},
                        {word: "rain-soaked", category: "Texture/Condition", values: ["gleaming", "rusted", "polished", "damaged", "pristine", "worn", "upgraded", "modified", "steaming", "sparking"]},
                        {word: "Motorcycle", category: "Artifact", values: ["Car", "Drone", "Robot", "Terminal", "Screen", "Booth", "Vendor", "Kiosk", "Vehicle", "Mech"]},
                        {word: "rainfall", category: "Weather", values: ["acid rain", "fog", "snow", "steam", "smog", "wind", "lightning", "mist", "hail", "dust storm"]}
                    ]},
                    { lesson: "Add architecture", reason: "Introduce urban structures", prompt: "Gritty Neon Alley with a rain-soaked, chrome Motorcycle, under heavy rainfall, between towering Skyscrapers", words: [
                        {word: "Gritty", category: "Mood", values: ["Sleek", "Dark", "Vibrant", "Mysterious", "Bustling", "Abandoned", "Futuristic", "Dangerous", "Electric", "Atmospheric"]},
                        {word: "Neon", category: "Light Source", values: ["LED", "Holographic", "Flickering", "Bright", "Glowing", "Electric", "Pulsing", "Vibrant", "Colorful", "Blazing"]},
                        {word: "Alley", category: "Place of Nature", values: ["Street", "Boulevard", "Corridor", "Pathway", "Passage", "Avenue", "Lane", "Tunnel", "Underpass", "Walkway"]},
                        {word: "rain-soaked", category: "Texture/Condition", values: ["gleaming", "rusted", "polished", "damaged", "pristine", "worn", "upgraded", "modified", "steaming", "sparking"]},
                        {word: "Motorcycle", category: "Artifact", values: ["Car", "Drone", "Robot", "Terminal", "Screen", "Booth", "Vendor", "Kiosk", "Vehicle", "Mech"]},
                        {word: "rainfall", category: "Weather", values: ["acid rain", "fog", "snow", "steam", "smog", "wind", "lightning", "mist", "hail", "dust storm"]},
                        {word: "Skyscrapers", category: "Artifact", values: ["Megastructures", "Arcologies", "Towers", "Complexes", "Pyramids", "Domes", "Platforms", "Stations", "Hubs", "Spires"]}
                    ]}
                ]
            },
            {
                name: "Ancient Temple",
                emoji: "⛩️",
                seed: "Sacred Grove",
                description: "Journey through spiritual and historical spaces",
                journey: [
                    { lesson: "Start small", reason: "Begin with a minimal seed", prompt: "Sacred Grove", words: [
                        {word: "Sacred", category: "Mood", values: ["Ancient", "Holy", "Blessed", "Divine", "Mystical", "Reverent", "Peaceful", "Hallowed", "Spiritual", "Consecrated"]},
                        {word: "Grove", category: "Place of Nature", values: ["Temple", "Shrine", "Sanctuary", "Monastery", "Chapel", "Altar", "Courtyard", "Garden", "Clearing", "Circle"]}
                    ]},
                    { lesson: "Add time", reason: "Set the temporal context", prompt: "Ancient Sacred Grove", words: [
                        {word: "Ancient", category: "Time of Day", values: ["Timeless", "Eternal", "Forgotten", "Lost", "Hidden", "Primordial", "Archaic", "Venerable", "Legendary", "Mythical"]},
                        {word: "Sacred", category: "Mood", values: ["Ancient", "Holy", "Blessed", "Divine", "Mystical", "Reverent", "Peaceful", "Hallowed", "Spiritual", "Consecrated"]},
                        {word: "Grove", category: "Place of Nature", values: ["Temple", "Shrine", "Sanctuary", "Monastery", "Chapel", "Altar", "Courtyard", "Garden", "Clearing", "Circle"]}
                    ]},
                    { lesson: "Specify subject", reason: "Introduce a focal element", prompt: "Ancient Sacred Grove with a stone Altar", words: [
                        {word: "Ancient", category: "Time of Day", values: ["Timeless", "Eternal", "Forgotten", "Lost", "Hidden", "Primordial", "Archaic", "Venerable", "Legendary", "Mythical"]},
                        {word: "Sacred", category: "Mood", values: ["Ancient", "Holy", "Blessed", "Divine", "Mystical", "Reverent", "Peaceful", "Hallowed", "Spiritual", "Consecrated"]},
                        {word: "Grove", category: "Place of Nature", values: ["Temple", "Shrine", "Sanctuary", "Monastery", "Chapel", "Altar", "Courtyard", "Garden", "Clearing", "Circle"]},
                        {word: "Altar", category: "Artifact", values: ["Statue", "Totem", "Pillar", "Monument", "Shrine", "Throne", "Brazier", "Well", "Fountain", "Obelisk"]}
                    ]},
                    { lesson: "Add detail", reason: "Enhance specificity", prompt: "Ancient Sacred Grove with a moss-covered, stone Altar", words: [
                        {word: "Ancient", category: "Time of Day", values: ["Timeless", "Eternal", "Forgotten", "Lost", "Hidden", "Primordial", "Archaic", "Venerable", "Legendary", "Mythical"]},
                        {word: "Sacred", category: "Mood", values: ["Ancient", "Holy", "Blessed", "Divine", "Mystical", "Reverent", "Peaceful", "Hallowed", "Spiritual", "Consecrated"]},
                        {word: "Grove", category: "Place of Nature", values: ["Temple", "Shrine", "Sanctuary", "Monastery", "Chapel", "Altar", "Courtyard", "Garden", "Clearing", "Circle"]},
                        {word: "moss-covered", category: "Texture/Condition", values: ["weathered", "carved", "polished", "cracked", "smooth", "rough", "ornate", "simple", "decorated", "plain"]},
                        {word: "Altar", category: "Artifact", values: ["Statue", "Totem", "Pillar", "Monument", "Shrine", "Throne", "Brazier", "Well", "Fountain", "Obelisk"]}
                    ]},
                    { lesson: "Add lighting", reason: "Control atmosphere with light", prompt: "Ancient Sacred Grove with a moss-covered, stone Altar, illuminated by flickering torchlight", words: [
                        {word: "Ancient", category: "Time of Day", values: ["Timeless", "Eternal", "Forgotten", "Lost", "Hidden", "Primordial", "Archaic", "Venerable", "Legendary", "Mythical"]},
                        {word: "Sacred", category: "Mood", values: ["Ancient", "Holy", "Blessed", "Divine", "Mystical", "Reverent", "Peaceful", "Hallowed", "Spiritual", "Consecrated"]},
                        {word: "Grove", category: "Place of Nature", values: ["Temple", "Shrine", "Sanctuary", "Monastery", "Chapel", "Altar", "Courtyard", "Garden", "Clearing", "Circle"]},
                        {word: "moss-covered", category: "Texture/Condition", values: ["weathered", "carved", "polished", "cracked", "smooth", "rough", "ornate", "simple", "decorated", "plain"]},
                        {word: "Altar", category: "Artifact", values: ["Statue", "Totem", "Pillar", "Monument", "Shrine", "Throne", "Brazier", "Well", "Fountain", "Obelisk"]},
                        {word: "torchlight", category: "Light Source", values: ["sunbeams", "candlelight", "moonlight", "firelight", "lamplight", "starlight", "crystal glow", "divine light", "aurora", "ember glow"]}
                    ]},
                    { lesson: "Add flora", reason: "Introduce plant life for richness", prompt: "Ancient Sacred Grove with a moss-covered, stone Altar, illuminated by flickering torchlight, surrounded by towering oak trees", words: [
                        {word: "Ancient", category: "Time of Day", values: ["Timeless", "Eternal", "Forgotten", "Lost", "Hidden", "Primordial", "Archaic", "Venerable", "Legendary", "Mythical"]},
                        {word: "Sacred", category: "Mood", values: ["Ancient", "Holy", "Blessed", "Divine", "Mystical", "Reverent", "Peaceful", "Hallowed", "Spiritual", "Consecrated"]},
                        {word: "Grove", category: "Place of Nature", values: ["Temple", "Shrine", "Sanctuary", "Monastery", "Chapel", "Altar", "Courtyard", "Garden", "Clearing", "Circle"]},
                        {word: "moss-covered", category: "Texture/Condition", values: ["weathered", "carved", "polished", "cracked", "smooth", "rough", "ornate", "simple", "decorated", "plain"]},
                        {word: "Altar", category: "Artifact", values: ["Statue", "Totem", "Pillar", "Monument", "Shrine", "Throne", "Brazier", "Well", "Fountain", "Obelisk"]},
                        {word: "torchlight", category: "Light Source", values: ["sunbeams", "candlelight", "moonlight", "firelight", "lamplight", "starlight", "crystal glow", "divine light", "aurora", "ember glow"]},
                        {word: "oak trees", category: "Flora", values: ["pine trees", "willow trees", "bamboo", "cedar trees", "fern groves", "ivy vines", "ancient redwoods", "cypress trees", "eucalyptus", "birch trees"]}
                    ]}
                ]
            }
        ];

        // Game state
        let currentTheme = null;
        let currentStep = 0;
        let isExplorationPhase = false;
        let activeWordData = null;

        // DOM elements
        const themeSelection = document.getElementById('themeSelection');
        const themeGrid = document.getElementById('themeGrid');
        const mainCard = document.getElementById('mainCard');
        const phaseIndicator = document.getElementById('phaseIndicator');
        const progressBar = document.getElementById('progressBar');
        const stepNumber = document.getElementById('stepNumber');
        const lessonTitle = document.getElementById('lessonTitle');
        const lessonExplanation = document.getElementById('lessonExplanation');
        const currentPrompt = document.getElementById('currentPrompt');
        const phaseTransition = document.getElementById('phaseTransition');
        const explorationActions = document.getElementById('explorationActions');
        const substitutionPanel = document.getElementById('substitutionPanel');
        const substitutionTitle = document.getElementById('substitutionTitle');
        const substitutionSections = document.getElementById('substitutionSections');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const hintText = document.getElementById('hintText');

        // Word category color mapping
        const categoryColors = {
            "Time of Day": "word-time",
            "Place of Nature": "word-place", 
            "Mood": "word-mood",
            "Artifact": "word-artifact",
            "Texture/Condition": "word-texture",
            "Light Source": "word-light",
            "Flora": "word-flora",
            "Weather": "word-weather",
            "Creature": "word-creature"
        };

        // Initialize the app
        function init() {
            showThemeSelection();
            setupEventListeners();
        }

        // Show theme selection
        function showThemeSelection() {
            themeSelection.style.display = 'block';
            mainCard.style.display = 'none';
            populateThemes();
        }

        // Populate theme cards
        function populateThemes() {
            themeGrid.innerHTML = '';
            
            themes.forEach((theme, index) => {
                const card = document.createElement('div');
                card.className = 'theme-card';
                card.onclick = () => selectTheme(index);
                
                card.innerHTML = `
                    <span class="theme-emoji">${theme.emoji}</span>
                    <div class="theme-name">${theme.name}</div>
                    <div class="theme-seed">"${theme.seed}"</div>
                    <div class="theme-description">${theme.description}</div>
                `;
                
                themeGrid.appendChild(card);
            });
        }

        // Select theme and start journey
        function selectTheme(themeIndex) {
            currentTheme = themes[themeIndex];
            currentStep = 0;
            isExplorationPhase = false;
            
            // Ensure clean state
            activeWordData = null;
            
            // Reset UI elements to default state
            if (phaseIndicator) {
                phaseIndicator.innerHTML = '🎓 Discovery Journey';
                phaseIndicator.style.background = 'linear-gradient(45deg, #ff6b6b, #ffa726)';
            }
            if (phaseTransition) phaseTransition.style.display = 'none';
            if (explorationActions) {
                explorationActions.style.display = 'none';
                explorationActions.style.opacity = '1';
                explorationActions.style.pointerEvents = 'auto';
            }
            if (substitutionPanel) substitutionPanel.style.display = 'none';
            
            themeSelection.style.display = 'none';
            mainCard.style.display = 'block';
            
            updateDisplay();
        }

        // Setup event listeners
        function setupEventListeners() {
            nextBtn.addEventListener('click', nextStep);
            prevBtn.addEventListener('click', prevStep);
        }

        // Update the display based on current state
        function updateDisplay() {
            if (!currentTheme) {
                console.warn('No current theme set, cannot update display');
                return;
            }
            
            const step = currentTheme.journey[currentStep];
            if (!step) {
                console.warn('Invalid step data for current step:', currentStep);
                return;
            }
            
            // Update progress
            const progress = ((currentStep + 1) / currentTheme.journey.length) * 100;
            if (progressBar) progressBar.style.width = progress + '%';
            
            // Update step info
            if (stepNumber) stepNumber.textContent = `Step ${currentStep + 1} of ${currentTheme.journey.length}`;
            if (lessonTitle) lessonTitle.textContent = step.lesson;
            if (lessonExplanation) lessonExplanation.textContent = step.reason;
            
            // Update prompt display
            updatePromptDisplay(step);
            
            // Update navigation based on phase and step
            if (prevBtn) prevBtn.disabled = currentStep === 0 && !isExplorationPhase;
            
            if (!isExplorationPhase) {
                if (currentStep === currentTheme.journey.length - 1) {
                    // At final step - show exploration CTA
                    if (nextBtn) {
                        nextBtn.textContent = '🎨 Start Exploring!';
                        nextBtn.style.display = 'block';
                        nextBtn.disabled = false;
                    }
                    if (hintText) hintText.textContent = 'Ready to experiment with word choices?';
                    // Hide exploration actions until user clicks Start Exploring
                    if (explorationActions) explorationActions.style.display = 'none';
                } else {
                    // In middle steps - show next step
                    if (nextBtn) {
                        nextBtn.textContent = 'Next Step →';
                        nextBtn.style.display = 'block';
                        nextBtn.disabled = false;
                    }
                    if (hintText) hintText.textContent = 'Watch how each step builds upon the last';
                    if (explorationActions) explorationActions.style.display = 'none';
                }
            } else {
                // In exploration phase - hide next button or make it go to next step if available
                if (currentStep < currentTheme.journey.length - 1) {
                    if (nextBtn) {
                        nextBtn.textContent = 'Next Step →';
                        nextBtn.style.display = 'block';
                        nextBtn.disabled = false;
                    }
                } else {
                    // At final step in exploration - hide next button
                    if (nextBtn) nextBtn.style.display = 'none';
                }
                if (hintText) hintText.textContent = 'Click any colored word to explore alternatives';
                // Exploration actions are shown by startExplorationPhase()
            }
        }

        // Update prompt display with proper word styling
        function updatePromptDisplay(step) {
            if (!step || !step.prompt || !currentPrompt) {
                console.warn('Missing step data or prompt element');
                return;
            }
            
            const words = step.prompt.split(' ');
            const wordData = step.words || [];
            
            let html = '';
            
            words.forEach(word => {
                const cleanWord = word.replace(/[,.]/, '');
                const punctuation = word.match(/[,.]/) ? word.match(/[,.]/)[0] : '';
                
                const wordInfo = wordData.find(w => 
                    w.word === cleanWord || 
                    w.word.includes(cleanWord) || 
                    cleanWord.includes(w.word)
                );
                
                if (wordInfo && categoryColors[wordInfo.category]) {
                    const colorClass = categoryColors[wordInfo.category];
                    const clickableClass = isExplorationPhase ? 'word-clickable' : '';
                    const tooltip = isExplorationPhase ? `<span class="category-tooltip">${wordInfo.category}</span>` : '';
                    
                    html += `<span class="${colorClass} ${clickableClass}" data-word="${wordInfo.word}" data-category="${wordInfo.category}">${cleanWord}${tooltip}</span>${punctuation} `;
                } else {
                    html += `${word} `;
                }
            });
            
            currentPrompt.innerHTML = html.trim();
            
            // Add click listeners for exploration phase
            if (isExplorationPhase) {
                // Use setTimeout to ensure DOM is updated
                setTimeout(() => {
                    const clickableWords = document.querySelectorAll('.word-clickable');
                    clickableWords.forEach(wordEl => {
                        if (wordEl && wordEl.addEventListener) {
                            wordEl.addEventListener('click', (e) => {
                                if (e.target && e.target.dataset) {
                                    openSubstitutionPanel(e.target);
                                }
                            });
                        }
                    });
                }, 10);
            }
        }

        // Handle next step
        function nextStep() {
            if (!isExplorationPhase && currentStep === currentTheme.journey.length - 1) {
                startExplorationPhase();
            } else if (currentStep < currentTheme.journey.length - 1) {
                currentStep++;
                updateDisplay();
            }
        }

        // Handle previous step
        function prevStep() {
            if (currentStep > 0) {
                currentStep--;
                updateDisplay();
            }
        }

        // Start exploration phase
        function startExplorationPhase() {
            isExplorationPhase = true;
            
            phaseIndicator.innerHTML = '🎨 Creative Playground';
            phaseIndicator.style.background = 'linear-gradient(45deg, #4caf50, #8bc34a)';
            
            phaseTransition.style.display = 'block';
            
            updateDisplay();
            
            setTimeout(() => {
                phaseTransition.style.display = 'none';
                // Show exploration actions after transition
                explorationActions.style.display = 'block';
            }, 3000);
        }

        // Open enhanced substitution panel
        function openSubstitutionPanel(wordElement) {
            if (!wordElement || !wordElement.dataset) {
                console.warn('Invalid word element provided');
                return;
            }
            
            const word = wordElement.dataset.word;
            const category = wordElement.dataset.category;
            
            if (!word || !category || !currentTheme || !currentTheme.journey) {
                console.warn('Missing word data or theme');
                return;
            }
            
            const step = currentTheme.journey[currentStep];
            if (!step || !step.words) {
                console.warn('Invalid step data');
                return;
            }
            
            const wordData = step.words.find(w => w.word === word);
            
            if (!wordData) {
                console.warn('Word data not found for:', word);
                return;
            }
            
            activeWordData = { element: wordElement, data: wordData };
            
            substitutionTitle.textContent = `Choose a different ${category.toLowerCase()}:`;
            
            // Create enhanced sections
            createSubstitutionSections(wordData);
            // Safety: remove any lingering inline handlers by rebuilding listeners only via JS
            setTimeout(() => {
                const opts = substitutionSections.querySelectorAll('.substitution-option');
                opts.forEach(opt => {
                    opt.addEventListener('click', () => substituteWord(opt.textContent));
                });
            }, 0);
            
            substitutionPanel.style.display = 'block';
        }

        // Create enhanced substitution sections
        function createSubstitutionSections(wordData) {
            if (!substitutionSections || !wordData || !wordData.values) {
                console.warn('Missing substitution sections element or word data');
                return;
            }
            
            substitutionSections.innerHTML = '';
            
            const values = wordData.values;
            const sectionsData = [
                {
                    title: "Popular Choices",
                    values: values.slice(0, 5),
                    description: "Most commonly used alternatives"
                },
                {
                    title: "Dramatic Variations", 
                    values: values.slice(5, 10),
                    description: "Words that create stronger emotional impact"
                }
            ];
            
            if (values.length > 10) {
                sectionsData.push({
                    title: "Creative Options",
                    values: values.slice(10),
                    description: "Unique and experimental choices"
                });
            }
            
            sectionsData.forEach(section => {
                if (section.values && section.values.length > 0) {
                    const sectionEl = document.createElement('div');
                    sectionEl.className = 'substitution-section';
                    
                    sectionEl.innerHTML = `
                        <div class="section-title">${section.title}</div>
                        <div class="substitution-options">
                            ${section.values.map(value => 
                                `<div class="substitution-option" onclick="substituteWord('${value.replace(/'/g, "\\'")}');">${value}</div>`
                            ).join('')}
                        </div>
                    `;
                    
                    substitutionSections.appendChild(sectionEl);
                }
            });
        }

        // Substitute word in prompt
        function substituteWord(newValue) {
            if (!activeWordData || !activeWordData.element) {
                console.warn('No active word data or element found');
                return;
            }
            // Capture element before we potentially clear activeWordData
            const el = activeWordData.element;
            el.textContent = newValue;
            // Animate change
            el.classList.add('prompt-word-enter');
            setTimeout(() => { el.classList.remove('prompt-word-enter'); }, 600);
            // Close after applying/animating (clears activeWordData)
            closeSubstitutionPanel();
        }

        // Close substitution panel
        function closeSubstitutionPanel() {
            substitutionPanel.style.display = 'none';
            activeWordData = null;
        }

        // Random substitution
        function randomSubstitution() {
            if (!activeWordData || !activeWordData.data) {
                console.warn('No active word data found for random substitution');
                return;
            }
            
            const values = activeWordData.data.values;
            if (values && values.length > 0) {
                const randomValue = values[Math.floor(Math.random() * values.length)];
                substituteWord(randomValue);
            }
        }

        // Suggest random change
        function suggestRandomChange() {
            const clickableWords = document.querySelectorAll('.word-clickable');
            if (!clickableWords || clickableWords.length === 0) {
                if (hintText) {
                    hintText.innerHTML = '⚠️ Start exploring mode first to use this feature!';
                }
                return;
            }
            
            const randomWord = clickableWords[Math.floor(Math.random() * clickableWords.length)];
            if (!randomWord || !randomWord.dataset) {
                console.warn('Invalid random word selected');
                return;
            }
            
            // Get word data
            const word = randomWord.dataset.word;
            const category = randomWord.dataset.category;
            
            if (!word || !category || !currentTheme || !currentTheme.journey) {
                console.warn('Missing data for random change');
                return;
            }
            
            const step = currentTheme.journey[currentStep];
            if (!step || !step.words) {
                console.warn('Invalid step data for random change');
                return;
            }
            
            const wordData = step.words.find(w => w.word === word);
            
            if (wordData && wordData.values && wordData.values.length > 0) {
                const randomValue = wordData.values[Math.floor(Math.random() * wordData.values.length)];
                randomWord.textContent = randomValue;
                
                // Add animation
                randomWord.classList.add('prompt-word-enter');
                setTimeout(() => {
                    if (randomWord) {
                        randomWord.classList.remove('prompt-word-enter');
                    }
                }, 600);
                
                // Show what changed
                if (hintText) {
                    hintText.innerHTML = `✨ Changed "${word}" to "${randomValue}" - try clicking other words!`;
                    setTimeout(() => {
                        if (hintText) {
                            hintText.innerHTML = 'Click any colored word to explore alternatives';
                        }
                    }, 3000);
                }
            } else {
                console.warn('No word data found for random substitution');
            }
        }

        // Show all categories with explanations
        function showAllCategories() {
            const categories = {
                "Time of Day": "Controls when the scene takes place - affects lighting and mood",
                "Place of Nature": "Sets the location - defines the environment and context", 
                "Mood": "Establishes emotional atmosphere - shapes how the scene feels",
                "Artifact": "Main objects or focal points - anchors attention and narrative",
                "Texture/Condition": "Describes surface qualities and age - adds visual depth",
                "Light Source": "Determines illumination - dramatically affects atmosphere",
                "Flora": "Plant life and vegetation - adds natural richness and beauty",
                "Weather": "Environmental conditions - transforms the scene's energy",
                "Creature": "Living beings - brings life and narrative to the scene"
            };
            
            // Create modal overlay
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
                backdrop-filter: blur(5px);
            `;
            
            // Create modal content
            const modal = document.createElement('div');
            modal.style.cssText = `
                background: white;
                border-radius: 20px;
                padding: 0;
                width: 95vw;
                max-width: 800px;
                max-height: 95vh;
                overflow: hidden;
                box-shadow: 0 25px 50px rgba(0,0,0,0.25);
                color: #333;
                position: relative;
                margin: 20px;
                display: flex;
                flex-direction: column;
            `;
            
            // Create header section
            const header = document.createElement('div');
            header.style.cssText = `
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                padding: 25px 30px 20px 30px;
                color: white;
                position: relative;
            `;
            
            // Create close button
            const closeBtn = document.createElement('button');
            closeBtn.innerHTML = '×';
            closeBtn.style.cssText = `
                position: absolute;
                top: 20px;
                right: 25px;
                background: rgba(255,255,255,0.2);
                border: none;
                color: white;
                font-size: 28px;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.3s ease;
                font-weight: 300;
            `;
            closeBtn.onmouseover = () => {
                closeBtn.style.background = 'rgba(255,255,255,0.3)';
                closeBtn.style.transform = 'scale(1.1)';
            };
            closeBtn.onmouseout = () => {
                closeBtn.style.background = 'rgba(255,255,255,0.2)';
                closeBtn.style.transform = 'scale(1)';
            };
            closeBtn.onclick = () => document.body.removeChild(overlay);
            
            // Create title
            const title = document.createElement('h2');
            title.innerHTML = '🎨 Word Categories Guide';
            title.style.cssText = `
                margin: 0 0 8px 0;
                font-size: 1.8rem;
                font-weight: 700;
                text-align: center;
                text-shadow: 0 2px 10px rgba(0,0,0,0.3);
            `;
            
            // Create subtitle/byline
            const subtitle = document.createElement('p');
            subtitle.innerHTML = 'Master the art of prompt crafting with strategic word choices';
            subtitle.style.cssText = `
                margin: 0 0 15px 0;
                text-align: center;
                opacity: 0.95;
                font-size: 1.05rem;
                font-weight: 400;
            `;
            
            // Create steps/info section
            const stepsInfo = document.createElement('div');
            stepsInfo.style.cssText = `
                background: rgba(255,255,255,0.15);
                border-radius: 10px;
                padding: 12px 16px;
                margin-top: 5px;
                text-align: center;
                font-size: 0.9rem;
                opacity: 0.9;
            `;
            stepsInfo.innerHTML = '<strong>💡 How to use:</strong> Click any colored word in your prompt to see alternative options from different categories';
            
            header.appendChild(closeBtn);
            header.appendChild(title);
            header.appendChild(subtitle);
            header.appendChild(stepsInfo);
            
            // Create content section
            const content = document.createElement('div');
            content.style.cssText = `
                padding: 25px 30px;
                flex: 1;
                overflow-y: auto;
            `;
            
            // Create categories grid
            const categoriesGrid = document.createElement('div');
            categoriesGrid.style.cssText = `
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 16px;
                margin-bottom: 20px;
            `;
            
            // Show only the most important categories for better readability
            const importantCategories = {
                "Mood": "Sets the emotional feeling of your scene",
                "Time of Day": "Controls lighting and atmosphere", 
                "Place": "Defines where your scene takes place",
                "Light Source": "Creates dramatic lighting effects",
                "Weather": "Adds environmental atmosphere",
                "Objects": "Main focal points in your scene"
            };
            
            Object.entries(importantCategories).forEach(([category, description]) => {
                const categoryEl = document.createElement('div');
                categoryEl.style.cssText = `
                    background: #f8f9fa;
                    border: 2px solid #e9ecef;
                    border-radius: 12px;
                    padding: 16px;
                    transition: all 0.3s ease;
                    cursor: pointer;
                `;
                categoryEl.onmouseover = () => {
                    categoryEl.style.borderColor = '#667eea';
                    categoryEl.style.transform = 'translateY(-2px)';
                    categoryEl.style.boxShadow = '0 4px 12px rgba(102, 126, 234, 0.15)';
                };
                categoryEl.onmouseout = () => {
                    categoryEl.style.borderColor = '#e9ecef';
                    categoryEl.style.transform = 'translateY(0)';
                    categoryEl.style.boxShadow = 'none';
                };
                
                const categoryTitle = document.createElement('h3');
                categoryTitle.textContent = category;
                categoryTitle.style.cssText = `
                    margin: 0 0 8px 0;
                    font-size: 1.1rem;
                    font-weight: 700;
                    color: #667eea;
                `;
                
                const categoryDesc = document.createElement('p');
                categoryDesc.textContent = description;
                categoryDesc.style.cssText = `
                    margin: 0;
                    font-size: 0.9rem;
                    line-height: 1.4;
                    color: #666;
                `;
                
                categoryEl.appendChild(categoryTitle);
                categoryEl.appendChild(categoryDesc);
                categoriesGrid.appendChild(categoryEl);
            });
            
            // Create footer section
            const footer = document.createElement('div');
            footer.style.cssText = `
                background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                border-top: 1px solid #e9ecef;
                padding: 20px 30px;
                text-align: center;
            `;
            
            const footerContent = document.createElement('div');
            footerContent.innerHTML = '✨ <strong>Pro Tip:</strong> Mix different categories to create unique and compelling prompts!';
            footerContent.style.cssText = `
                font-size: 0.95rem;
                color: #495057;
                font-weight: 500;
            `;
            
            content.appendChild(categoriesGrid);
            footer.appendChild(footerContent);
            
            // Assemble modal
            modal.appendChild(header);
            modal.appendChild(content);
            modal.appendChild(footer);
            overlay.appendChild(modal);
            
            // Add to page
            document.body.appendChild(overlay);
            
            // Close on overlay click
            overlay.onclick = (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                }
            };
            
            // Close on Escape key
            const handleEscape = (e) => {
                if (e.key === 'Escape') {
                    document.body.removeChild(overlay);
                    document.removeEventListener('keydown', handleEscape);
                }
            };
            document.addEventListener('keydown', handleEscape);
        }

        // Reset to theme selection
        function resetToStart() {
            // Create modal overlay
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
                backdrop-filter: blur(5px);
            `;
            
            // Create modal content
            const modal = document.createElement('div');
            modal.style.cssText = `
                background: white;
                border-radius: 20px;
                padding: 0;
                max-width: 450px;
                box-shadow: 0 25px 50px rgba(0,0,0,0.25);
                color: #333;
                position: relative;
                margin: 20px;
                overflow: hidden;
                display: flex;
                flex-direction: column;
            `;
            
            // Create header section
            const header = document.createElement('div');
            header.style.cssText = `
                background: linear-gradient(135deg, #ff6b6b 0%, #ffa726 100%);
                padding: 25px 30px 20px 30px;
                color: white;
                text-align: center;
                position: relative;
            `;
            
            // Create close button
            const closeBtn = document.createElement('button');
            closeBtn.innerHTML = '×';
            closeBtn.style.cssText = `
                position: absolute;
                top: 20px;
                right: 25px;
                background: rgba(255,255,255,0.2);
                border: none;
                color: white;
                font-size: 28px;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.3s ease;
                font-weight: 300;
            `;
            closeBtn.onmouseover = () => {
                closeBtn.style.background = 'rgba(255,255,255,0.3)';
                closeBtn.style.transform = 'scale(1.1)';
            };
            closeBtn.onmouseout = () => {
                closeBtn.style.background = 'rgba(255,255,255,0.2)';
                closeBtn.style.transform = 'scale(1)';
            };
            closeBtn.onclick = () => document.body.removeChild(overlay);
            
            // Create title
            const title = document.createElement('h3');
            title.innerHTML = '🔄 Start New Journey';
            title.style.cssText = `
                margin: 0 0 8px 0;
                font-size: 1.6rem;
                font-weight: 700;
                text-shadow: 0 2px 10px rgba(0,0,0,0.3);
            `;
            
            // Create subtitle/byline
            const subtitle = document.createElement('p');
            subtitle.innerHTML = 'Ready to explore a different creative path?';
            subtitle.style.cssText = `
                margin: 0 0 15px 0;
                opacity: 0.95;
                font-size: 1rem;
                font-weight: 400;
            `;
            
            // Create steps/info section
            const stepsInfo = document.createElement('div');
            stepsInfo.style.cssText = `
                background: rgba(255,255,255,0.15);
                border-radius: 10px;
                padding: 12px 16px;
                margin-top: 5px;
                text-align: center;
                font-size: 0.9rem;
                opacity: 0.9;
            `;
            stepsInfo.innerHTML = '<strong>⚠️ Note:</strong> This will reset your current progress and return you to theme selection';
            
            header.appendChild(closeBtn);
            header.appendChild(title);
            header.appendChild(subtitle);
            header.appendChild(stepsInfo);
            
            // Create content section
            const content = document.createElement('div');
            content.style.cssText = `
                padding: 25px 30px;
                text-align: center;
            `;
            
            // Create message
            const message = document.createElement('p');
            message.innerHTML = 'Are you sure you want to start over? Your current progress will be lost and you\'ll return to the theme selection screen.';
            message.style.cssText = `
                margin: 0 0 25px 0;
                color: #666;
                line-height: 1.5;
                font-size: 1rem;
            `;
            
            // Create buttons container
            const buttons = document.createElement('div');
            buttons.style.cssText = `
                display: flex;
                gap: 15px;
                justify-content: center;
                margin-top: 10px;
            `;
            
            // Create Cancel button
            const cancelBtn = document.createElement('button');
            cancelBtn.textContent = 'Cancel';
            cancelBtn.style.cssText = `
                background: #f8f9fa;
                color: #666;
                border: 2px solid #e9ecef;
                padding: 12px 24px;
                border-radius: 10px;
                cursor: pointer;
                font-weight: 600;
                font-size: 0.95rem;
                transition: all 0.3s ease;
                min-width: 100px;
            `;
            cancelBtn.onmouseover = () => {
                cancelBtn.style.background = '#e9ecef';
                cancelBtn.style.borderColor = '#dee2e6';
                cancelBtn.style.transform = 'translateY(-1px)';
            };
            cancelBtn.onmouseout = () => {
                cancelBtn.style.background = '#f8f9fa';
                cancelBtn.style.borderColor = '#e9ecef';
                cancelBtn.style.transform = 'translateY(0)';
            };
            cancelBtn.onclick = () => document.body.removeChild(overlay);
            
            // Create OK button
            const okBtn = document.createElement('button');
            okBtn.textContent = 'Start New Journey';
            okBtn.style.cssText = `
                background: linear-gradient(45deg, #ff6b6b, #ffa726);
                color: white;
                border: none;
                padding: 12px 24px;
                border-radius: 10px;
                cursor: pointer;
                font-weight: 600;
                font-size: 0.95rem;
                transition: all 0.3s ease;
                min-width: 140px;
                box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
            `;
            okBtn.onmouseover = () => {
                okBtn.style.transform = 'translateY(-2px)';
                okBtn.style.boxShadow = '0 6px 16px rgba(255, 107, 107, 0.4)';
            };
            okBtn.onmouseout = () => {
                okBtn.style.transform = 'translateY(0)';
                okBtn.style.boxShadow = '0 2px 8px rgba(255, 107, 107, 0.3)';
            };
            okBtn.onclick = () => {
                // Reset all state
                currentTheme = null;
                currentStep = 0;
                isExplorationPhase = false;
                activeWordData = null;
                
                // Reset phase indicator to default
                if (phaseIndicator) {
                    phaseIndicator.innerHTML = '🎓 Discovery Journey';
                    phaseIndicator.style.background = 'linear-gradient(45deg, #ff6b6b, #ffa726)';
                }
                
                // Hide exploration elements
                if (phaseTransition) phaseTransition.style.display = 'none';
                if (explorationActions) {
                    explorationActions.style.display = 'none';
                    explorationActions.style.opacity = '1';
                    explorationActions.style.pointerEvents = 'auto';
                }
                if (substitutionPanel) substitutionPanel.style.display = 'none';
                
                // Reset progress bar
                if (progressBar) progressBar.style.width = '16.67%';
                
                // Reset navigation buttons
                if (nextBtn) {
                    nextBtn.textContent = 'Next Step →';
                    nextBtn.style.display = 'block';
                    nextBtn.disabled = false;
                }
                if (prevBtn) prevBtn.disabled = true;
                if (hintText) hintText.textContent = 'Watch how each step builds upon the last';
                
                // Remove modal
                document.body.removeChild(overlay);
                
                // Show theme selection
                showThemeSelection();
            };
            
            // Assemble modal
            buttons.appendChild(cancelBtn);
            buttons.appendChild(okBtn);
            content.appendChild(message);
            content.appendChild(buttons);
            modal.appendChild(header);
            modal.appendChild(content);
            overlay.appendChild(modal);
            
            // Add to page
            document.body.appendChild(overlay);
            
            // Close on overlay click
            overlay.onclick = (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                }
            };
            
            // Close on Escape key
            const handleEscape = (e) => {
                if (e.key === 'Escape') {
                    document.body.removeChild(overlay);
                    document.removeEventListener('keydown', handleEscape);
                }
            };
            document.addEventListener('keydown', handleEscape);
        }

        // Start the app
        init();
    </script>
</body>
</html>